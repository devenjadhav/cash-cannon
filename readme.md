# Campfire Cash Cannon

A reliable service written in go to send money / disbursements to users using the HCB V4 API and Airtable.

Airtable schema definition and documentation:

Base: Campfire
Table: events
View ID: viwd1z4JsMUf15DNb
Relevant field names:
'hcb_event_id' - needed for the HCB API, unique to each event
'amount_owed' - total amount owed to an event at a particular time.
'record_id' - the current event record ID in airtable

Base: Campfire
Table: disbursements
'disbursement_id' - autonumber id generated by airtable for each new record
'associated_event' - airtable ID of the event this disbursement is linked to
'amount' - dollar amount for disbursement
'status' - status of disbursement. Can either be pending, processed, or failed
'disbursement_type' - type of disbursement. For the purposes of this app, this should always be set to 'autogrant'.
'notes'

## App functionality

1. The app has a page behind basic access authentication, pulling from username and password stored in the env file. This page has a button that lets us trigger the disbursement, and some stats / dashboard to keep track of everything.

2. Once the disbursements are triggered, the app goes through all the records in the above given view ID of the events table. For each event, read the 'amount_owed' field.

3. Then, if that amount is greater than zero, for each event, create a disbursement in the disbursements table. The amount for this disbursement should be the 'amount_owed' in the events table. As soon as you create the disbursement, set status as 'pending' and disbursement_type as 'autogrant'.

4. Then use the following API request to send the disbursement through the HCB bank:

https://hcb.hackclub.com/api/v4/organizations/campfire/transfers/ -H "Authorization: Bearer <token>" -H "Content-Type: application/json" -d '{"to_organization_id": "<hcb_event_id>", "name": "Campfire signup grant <disbursement_id>", "amount_cents": <amount>}'

If the call succeeds, change status of the disbursement to 'processed'. If not, mark as failed and add the error message to the 'notes' field in disbursements.

Log everything thoroughly in the notes section, even if the call succeeds. Its very important to have context.

Additionally, there might be more than a 100 events at a time, so make sure to implement pagination.
